<!doctype html>

<html lang="fi">
  <head>
    <meta charset="utf-8">
    <meta name="MIAULXRAFFE" content="KoodiMursu, OssiKainalo">
    <meta name="kuvaus" content="Web-sovellus, joka näyttää valitun Finnkino teatterin sen päiväiset näytökset ja näytös ajat.">
    <title>MIAULXRAFFE</title>
    <link href="style.css" rel="stylesheet">
    <script
			  src="http://code.jquery.com/jquery-3.3.1.min.js"
			  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
			  crossorigin="anonymous"></script>
	<script>

//suorittaa funktiot sivun latautuessa
  $(document).ready(function () {
  loadTheatres();
  loadSchedule();
  loadMovies();
  });


  //lataa leffat dropdowniin
    function loadMovies() {
    $(".result").load("https://www.finnkino.fi/xml/Schedule/", function (elokuvadata) {
    console.log(elokuvadata);
    xmlDoc = $.parseXML(elokuvadata),
    $xml = $(xmlDoc),
    $name = $xml.find("Title");
    var dropDown = $('#elokuva');
    $.each($name, function (val, text) {
    dropDown.append(
    $('<option></option>').val(val.innerHTML).html(text)
    );
    });
    });
    }


//lataa teatterit dropdowniin
  function loadTheatres() {
  $(".result").load("https://www.finnkino.fi/xml/TheatreAreas/", function (teatteridata) {
  console.log(teatteridata);
  xmlDoc = $.parseXML(teatteridata),
  $xml = $(xmlDoc),
  $name = $xml.find("Name");
  var dropDown = $('#teatteri');
  $.each($name, function (val, text) {
  dropDown.append(
  $('<option></option>').val(val.innerHTML).html(text)
  );
  });
  });
  }

  //lataa aikataulut
  function loadSchedule() {
  $( ".result" ).load( "https://www.finnkino.fi/xml/ScheduleDates/", function(aikadata) {
  console.log(aikadata);
  xmlDoc2 = $.parseXML(aikadata),
  $xml2 = $(xmlDoc2),
  $time = $xml2.find("dateTime");
  var dropDown = $('#aika');
  $.each($time, function (val, text) {
  dropDown.append(
  $('<option></option>').val(val.innerHTML).html(text)
  );
  });
  });
  }



//funktio joka näyttää apin tulokset sivulla
      function showmovies(){
       var x = document.forms[0];
        var teatteri = x.teatteri.value;
        var aika = x.aika.value;
        var elokuva = x.elokuva.value;

        console.log("Valitut arvot ovat teatteri: " + teatteri + ", aikataulu:" + aika + ", elokuva:" + elokuva);
        console.log("Arvot valittu:\nteatteri:" + teatteri + "\naikataulu:" + aika + "\nelokuva:" + elokuva);
      $.get("https://www.finnkino.fi/xml/TheatreAreas/", function( data ) {
        $(".result").html( data );
        console.log("A suoritettu!");
      });
	  $( ".result" ).load( "https://www.finnkino.fi/xml/TheatreAreas/", function(teatteridata) {
  console.log( "B was performed." );
  console.log(teatteridata);
  });
  	  $( ".result" ).load( "https://www.finnkino.fi/xml/ScheduleDates/", function(aikadata) {
  console.log( "C was performed." );
  console.log(aikadata);
});
  	  $( ".result" ).load( "https://www.finnkino.fi/xml/Schedule/", function(elokuvadata) {
  console.log( "D was performed." );
  console.log(elokuvadata);
});
      }
    </script>
  </head>
  <body>
  <div class= "banner" >
  <h1>MIAULXRAFFE</h1>
  </div>
  <div class= "valikko">
  <div class= "reunafilmi">
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  </div>
                <form onsubmit="return false">
				<br>
                <select name="teatteri" id="teatteri">

    </select>

                <select name="aika" id="aika">


   </select>

                <select name="elokuva" id="elokuva">

</select>
                <br>
                <button type="submit" class="Go" onclick="showmovies()"><span>Näytä ohjelmisto</span></button>

				</form>
				<br>
				</div>
<div class= "reunafilmi">
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
</div>
    <div class = "result">
    </div>

  </body>
</html>
